============================= test session starts ==============================
platform linux -- Python 3.6.9, pytest-5.3.0, py-1.8.0, pluggy-0.13.1
rootdir: /devito, inifile: setup.cfg
plugins: nbval-0.9.3, cov-2.8.1
collected 1053 items / 2 skipped / 1051 selected

tests/test_adjoint.py ..........................                         [  2%]
tests/test_autotuner.py ..........s.....                                 [  3%]
tests/test_builtins.py ....s...............s..s                          [  6%]
tests/test_caching.py .................................................. [ 11%]
                                                                         [ 11%]
tests/test_checkpointing.py .......                                      [ 11%]
tests/test_constant.py .                                                 [ 11%]
tests/test_data.py ..........................ssssssssssssssssss.ss..     [ 16%]
tests/test_dependency_bugs.py .                                          [ 16%]
tests/test_derivatives.py .............................................. [ 20%]
........................................................................ [ 27%]
........................................................................ [ 34%]
......                                                                   [ 35%]
tests/test_differentiable.py ..                                          [ 35%]
tests/test_dimension.py ...............................                  [ 38%]
tests/test_dle.py ...................................................... [ 43%]
...........................................                              [ 47%]
tests/test_docstrings.py ................                                [ 49%]
tests/test_dse.py ......x............................................... [ 54%]
................x..........s....                                         [ 57%]
tests/test_gradient.py ....                                              [ 57%]
tests/test_interpolation.py ........................                     [ 59%]
tests/test_ir.py ....................................................... [ 65%]
................                                                         [ 66%]
tests/test_mpi.py ssssssssssssssssssssssssssssssssssssssssssssssssssssss [ 71%]
ss                                                                       [ 71%]
tests/test_operator.py ................................................. [ 76%]
........................................................................ [ 83%]
................................                                         [ 86%]
tests/test_pickle.py .................ss.                                [ 88%]
tests/test_resample.py .                                                 [ 88%]
tests/test_save.py ..                                                    [ 88%]
tests/test_staggered_utils.py .........                                  [ 89%]
tests/test_subdomains.py ...                                             [ 89%]
tests/test_symbolic_coefficients.py .....F                               [ 90%]
tests/test_tensors.py .................................................. [ 95%]
...........................                                              [ 97%]
tests/test_timestepping.py .......                                       [ 98%]
tests/test_tools.py .....                                                [ 98%]
tests/test_tti.py ....                                                   [ 99%]
tests/test_visitors.py .........                                         [100%]

=================================== FAILURES ===================================
______________________ TestSC.test_function_coefficients _______________________

self = <test_symbolic_coefficients.TestSC object at 0x7f5daf79b7f0>

    def test_function_coefficients(self):
        """Test that custom function coefficients return the expected result"""
        so = 2
        grid = Grid(shape=(4, 4))
        f0 = TimeFunction(name='f0', grid=grid, space_order=so, coefficients='symbolic')
        f1 = TimeFunction(name='f1', grid=grid, space_order=so)
        x, y = grid.dimensions
    
        s = Dimension(name='s')
        ncoeffs = so+1
    
        wshape = list(grid.shape)
        wshape.append(ncoeffs)
        wshape = as_tuple(wshape)
    
        wdims = list(grid.dimensions)
        wdims.append(s)
        wdims = as_tuple(wdims)
    
        w = Function(name='w', dimensions=wdims, shape=wshape)
        w.data[:, :, 0] = 0.0
        w.data[:, :, 1] = -1.0/grid.spacing[0]
        w.data[:, :, 2] = 1.0/grid.spacing[0]
    
        f_x_coeffs = Coefficient(1, f0, x, w)
    
        subs = Substitutions(f_x_coeffs)
    
        eq0 = Eq(f0.dt + f0.dx, 1, coefficients=subs)
        eq1 = Eq(f1.dt + f1.dx, 1)
    
        stencil0 = solve(eq0.evaluate, f0.forward)
        stencil1 = solve(eq1.evaluate, f1.forward)
    
        op0 = Operator(Eq(f0.forward, stencil0))
        op1 = Operator(Eq(f1.forward, stencil1))
    
        op0(time_m=0, time_M=5, dt=1.0)
        op1(time_m=0, time_M=5, dt=1.0)
    
>       assert np.all(np.isclose(f0.data[:] - f1.data[:], 0.0, atol=1e-5, rtol=0))
E       assert Data(False)
E        +  where Data(False) = <function all at 0x7f5de538fe18>(Data([[[False, False, False, False],\n       [False, False, False, False],\n       [ True,  True,  True,  True],\n       ...alse],\n       [False, False, False, False],\n       [False, False, False, False],\n       [ True,  True,  True,  True]]]))
E        +    where <function all at 0x7f5de538fe18> = np.all
E        +    and   Data([[[False, False, False, False],\n       [False, False, False, False],\n       [ True,  True,  True,  True],\n       ...alse],\n       [False, False, False, False],\n       [False, False, False, False],\n       [ True,  True,  True,  True]]]) = <function isclose at 0x7f5de5371268>((Data([[[-1452., -1452., -1452., -1452.],\n       [ 3327.,  3327.,  3327.,  3327.],\n       [-3414., -3414., -3414., -341...3.,   383.,   383.],\n       [ -598.,  -598.,  -598.,  -598.],\n       [  341.,   341.,   341.,   341.]]], dtype=float32) - Data([[[-1451.9998  , -1451.9998  , -1451.9998  , -1451.9998  ],\n       [ 3326.9995  ,  3326.9995  ,  3326.9995  ,  33...4 ,  -597.99994 ,  -597.99994 ],\n       [  341.      ,   341.      ,   341.      ,   341.      ]]],\n     dtype=float32)), 0.0, atol=1e-05, rtol=0)
E        +      where <function isclose at 0x7f5de5371268> = np.isclose

tests/test_symbolic_coefficients.py:96: AssertionError
----------------------------- Captured stderr call -----------------------------
/tmp/devito-jitcache-uid0/28a0c1d4f6f5711828a8c4cd1ff27eaa7607404e.c: In function ‘Kernel’:
/tmp/devito-jitcache-uid0/28a0c1d4f6f5711828a8c4cd1ff27eaa7607404e.c:39: warning: ignoring #pragma omp simd [-Wunknown-pragmas]
       #pragma omp simd aligned(f0,w:32)
 
Operator `Kernel` run in 0.01 s
/tmp/devito-jitcache-uid0/0031268cb9efe9dfa4f656da51efd0d4fa4b9d00.c: In function ‘Kernel’:
/tmp/devito-jitcache-uid0/0031268cb9efe9dfa4f656da51efd0d4fa4b9d00.c:38: warning: ignoring #pragma omp simd [-Wunknown-pragmas]
       #pragma omp simd aligned(f1:32)
 
Operator `Kernel` run in 0.01 s
------------------------------ Captured log call -------------------------------
INFO     Devito:logger.py:129 Operator `Kernel` run in 0.01 s
INFO     Devito:logger.py:129 Operator `Kernel` run in 0.01 s
====== 1 failed, 967 passed, 85 skipped, 2 xfailed in 1058.91s (0:17:38) =======
